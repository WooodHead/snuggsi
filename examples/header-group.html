<template id=header-group>

<style>

  header-group
    { display: block }

  header-group
    hgroup
      { background: #bada55; color: var(--darkest-color) }

</style>

<hgroup>
  <h1><a href=/examples/index.html>snuggsi ãƒ„</a></h1>
  <slot name=header><h2>try an example</h2></slot>
</hgroup>

</template>

<script>
const tag = `header-group`

Element `header-group`

(class extends HTMLElement {

  static onimportload (event) {
    let template = event.target.import
      .querySelector ('template')

      document
        .querySelector('head')
        .appendChild (template)

      // possibly should be adopting node into document
      // and should do it on DOMContentLoaded hook up onimportload

    const shadow = function (element) {
      let fragment = template.content.cloneNode (true)

      fragment.slots =
        Array.from (fragment.querySelectorAll ('slot'))

      element.slots =
        Array.from (element.querySelectorAll ('[slot]'))

      element.slots.map (function (namedslot) {
        fragment.slots
          .filter (slot =>
            (slot.getAttribute ('name') === namedslot.getAttribute ('slot'))
          )
          .map (slot =>
            // Replace slot due to uncertainty
            // https://github.com/devpunks/snuggsi/pull/23/files#r113990636

            // prefer to use replaceWith however support is sparse
            // https://developer.mozilla.org/en-US/docs/Web/API/ChildNode/replaceWith
            // using `Node.parentNode` & `Node.replaceChid` as is defined in (ancient) W3C DOM Level 1,2,3
            // https://developer.mozilla.org/en-US/docs/Web/API/Node/parentNode
            // https://developer.mozilla.org/en-US/docs/Web/API/Node/replaceChild

            slot.parentNode
              .replaceChild (namedslot, slot)
          )
      })

      element.innerHTML = ''
      element.append (fragment)
    }

    Array.from
      // should be using currentScript ?
      (document.getElementsByTagName (tag))
      .map (shadow)
  }

  initialize () {
    const selector = `link#${tag}, link[href*='${tag}']`
    const link = document
      .querySelector (selector)

    ! link.onload &&
    !! (link.onload = this.constructor.onimportload.bind (this))
  }
})

</script>

