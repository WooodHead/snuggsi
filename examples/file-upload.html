<title>snuggsi ツ - File Upload</title>

<meta charset=UTF-8>
<meta name=viewport content=width=device-width,initial-scale=1>

<link rel=stylesheet href=http://www.devpunks.com/typography.css>

<script nomodule    src=https://unpkg.com/snuggsi/snuggsi.js></script>
<script nomodule    src=https://unpkg.com/snuggsi/examples/webcomponents-hi-ce.js></script>

<hgroup>
  <h1>snuggsi ツ</h1>
  <h2>File Upload</h2>
</hgroup>

<file-upload>

  <input multiple id=files name=files[] type=file>
  <label for=files ondragover="event.preventDefault()" ondragenter=ondragstart ondragleave=ondragend ondrop=ondragdrop>
    Click to upload file...
  </label>

  <table style="width:300px">
    <thead style="text-align: left">
      <tr>
        <th width="1%"></th>
        <th>Name</th>
        <th width="10%">Size</th>
        <th width="1%"></th>
      </tr>
    </thead>
    <tbody>
      <template name=files>
        <tr>

          <td>
            <img src={icon_url} alt={type} hidden={hidden} style="width: 1em; height: 1em">
          </td>
          <td>
            {name}
          </td>
          <td>
            {size}
          </td>
          <td style="cursor:pointer">
            <a onclick=onremove data-index={#}>&times;</a>
          </td>
        </tr>
      </template>
    </tbody>
  </table>

  <a onclick=onclear>Clear</a>

<style>

file-upload input[type=file] {
  opacity: 0;
  z-index: -1;
  width: 0.1px;
  height: 0.1px;
  overflow: hidden;
  position: absolute
}
file-upload input[type=file] + label {
  display: block;
  padding: 2em 0;
  margin: 1em 20%;
  cursor: pointer;
  font-size: 1.25em;
  text-align: center;
  color: rgba(20,20,20,0.6);
  background-color: rgba(240,240,240, 0.8)
}

file-upload input[type=file] + label:hover
  { background-color: rgba(240,240,240, 1.0) }

</style>

<script>

Element `file-upload`

(class extends HTMLElement {

  initialize ()
    { this.context.files = [] }


  static onchange (event) {
    if (!!! event.target.files) return

    this.add_files(event.target.files)

    this.render ()
  }

  static onremove (event) {
    this.context.files.splice(event.target.dataset.index, 1)

    this.render ()
  }

  static onclear (event) {
    this.context.files = []

    this.render ()
  }

  static ondragstart (event) {
    event.target.innerHTML = 'Drop here!'

    event.preventDefault ()
  }

  static ondragend (event) {
    this.reset_label(event.target)
  }

  static ondragdrop (event) {
    this.reset_label(event.target)

    event.preventDefault ()

    var files = event.dataTransfer.files

    if (!!! files) return

    this.add_files(files)

    this.render ()
  }

  reset_label (label) {
    label.innerHTML = 'Click to upload file...'
  }

  add_files (files) {
    // Should have a sanity check.
    // All `files` should be of class File
    this.context.files =
      this.context.files.concat (...files)
  }

  get files () {
    return this.context.files
      .map ((file, idx) => this.constructor.add_icon_url(file)) 
  }


  static add_icon_url (file) {
    var icon_url = this.mimetype_icons[file.type]

    file.icon_url = icon_url === undefined ? '' : icon_url
    file.hidden_icon = icon_url === undefined ? 'hidden' : ''

    return file
  }


  static get mimetype_icons () {
    return {
      'application/pdf': 'app-pdf.png',
       'text/plain'    : 'txt-plain.png',
       //'image/png'     : 'img-all.png',
       'application/vnd.oasis.opendocument.text'       : 'app-word.png',
       'application/vnd.oasis.opendocument.spreadsheet': 'app-excel.png',
       'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'app-word.png',
       'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'      : 'app-excel.png'
     }
  }


})

</script>

</file-upload>

<script src=../../vendor/browser-sync.es></script>
